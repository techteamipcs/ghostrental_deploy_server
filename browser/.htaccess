# Enable Rewrite Engine
RewriteEngine on

# --------------------------
# Redirects for external links
# --------------------------
RewriteRule ^Location$ https://www.google.com/maps/place/Ghost+Rentals/@25.1221608,55.2232148,17z/data=!3m1!4b1!4m6!3m5!1s0x3e5f6bb7c49961e7:0x4b3661e383f4d582!8m2!3d25.122156!4d55.2257897!16s%2Fg%2F11vynydv15?entry=tts&g_ep=EgoyMDI1MDcwNy4wIPu8ASoASAFQAw%3D%3D&skid=ede434f7-ecc1-4dd5-9f8a-a94f8d3b0d58 [R=301,L]
RewriteRule ^Instagram$ https://www.instagram.com/ghost.rentals/?hl=en [R=301,L]
RewriteRule ^Review$ https://www.google.com/maps/place//data=!4m3!3m2!1s0x3e5f6bb7c49961e7:0x4b3661e383f4d582!12e1?source=g.page.m.ia._&laa=nmx-review-solicitation-ia2 [R=301,L]
RewriteRule ^Facebook$ https://www.facebook.com/Ghostrentalsdubai [R=301,L]
RewriteRule ^Tiktok$ https://www.tiktok.com/@ghostrentals [R=301,L]
RewriteRule ^Linkedin$ https://ae.linkedin.com/company/ghostrentals [R=301,L]
RewriteRule ^YouTube$ https://www.youtube.com/@GhostRentalsDXB [R=301,L]

# --------------------------
# Don't rewrite existing files or directories
# --------------------------
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# --------------------------
# Rewrite everything else to index.html for Angular SPA
# --------------------------
RewriteRule ^index\.html$ - [L]

# Exclude sitemap.xml from rewrites
RewriteCond %{REQUEST_URI} ^/sitemap\.xml$ [NC]
RewriteRule .* - [L]

# Rewrite SPA routes and mark them for 404 handling if file/folder does not exist
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.html [E=ANGULAR404:1,L]

# --------------------------
# Custom 404 handled by Angular
# --------------------------
ErrorDocument 404 /index.html

# Force real 404 status code for SEO
<If "%{ENV:ANGULAR404} == '1'">
    Header always set Status "404 Not Found"
</If>

# --------------------------
# Enable Compression
# --------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-otf
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain
</IfModule>

<IfModule mod_gzip.c>
  mod_gzip_on Yes
  mod_gzip_dechunk Yes
  mod_gzip_item_include file .(html?|txt|css|js|php|pl)$
  mod_gzip_item_include handler ^cgi-script$
  mod_gzip_item_include mime ^text/.*
  mod_gzip_item_include mime ^application/x-javascript.*
  mod_gzip_item_exclude mime ^image/.*
  mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
</IfModule>

# --------------------------
# Leverage Browser Caching
# --------------------------
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access 1 year"
  ExpiresByType image/jpeg "access 1 year"
  ExpiresByType image/gif "access 1 year"
  ExpiresByType image/png "access 1 year"
  ExpiresByType text/css "access 1 month"
  ExpiresByType text/html "access 1 month"
  ExpiresByType application/pdf "access 1 month"
  ExpiresByType text/x-javascript "access 1 month"
  ExpiresByType application/x-shockwave-flash "access 1 month"
  ExpiresByType image/x-icon "access 1 year"
  ExpiresDefault "access 1 month"
</IfModule>

# --------------------------
# Security Headers
# --------------------------
<IfModule mod_headers.c>
  # Enforce HTTPS
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

  # Prevent clickjacking
  Header always set X-Frame-Options "SAMEORIGIN"

  # Prevent MIME sniffing
  Header always set X-Content-Type-Options "nosniff"

  # Referrer policy
  Header always set Referrer-Policy "strict-origin-when-cross-origin"

  # Content Security Policy (allow API on :5014)
  #Header always set Content-Security-Policy "default-src 'self'; connect-src 'self' https://www.ghostrentals.com:5014; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; media-src 'self' https://www.ghostrentals.com:5014; object-src 'none'"
	Header always set Content-Security-Policy " default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; script-src * 'unsafe-inline' 'unsafe-eval' data: blob:; style-src * 'unsafe-inline' data:; img-src * data: blob:; font-src * data:; connect-src *; media-src * data: blob:; frame-src *; object-src *; "

  # Cache-Control rules
  <filesmatch "\.(ico|flv|jpg|jpeg|png|gif|css|swf)$">
    Header set Cache-Control "max-age=2678400, public"
  </filesmatch>
  <filesmatch "\.(html|htm)$">
    Header set Cache-Control "max-age=7200, private, must-revalidate"
  </filesmatch>
  <filesmatch "\.(pdf)$">
    Header set Cache-Control "max-age=86400, public"
  </filesmatch>
  <filesmatch "\.(js)$">
    Header set Cache-Control "max-age=2678400, private"
  </filesmatch>
</IfModule>

# --------------------------
# Ensure .txt files (like ads.txt) are served with correct MIME type
# --------------------------
<IfModule mod_mime.c>
  AddType text/plain .txt
</IfModule>
